let currentLang=localStorage.getItem("aircat_lang");if(!currentLang){const e=navigator.language.toLowerCase();currentLang=e.includes("zh-tw")||e.includes("zh-hk")?"zh-TW":e.includes("zh")?"zh-CN":"en"}function updateLanguage(e){currentLang=e,localStorage.setItem("aircat_lang",e),document.documentElement.lang=e,document.querySelectorAll("[data-i18n]").forEach((t=>{const n=t.getAttribute("data-i18n");translations[e][n]&&("INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.placeholder=translations[e][n]:t.innerText=translations[e][n])})),document.querySelectorAll("[data-i18n-title]").forEach((t=>{const n=t.getAttribute("data-i18n-title");translations[e][n]&&(t.title=translations[e][n])}));document.getElementById("langDisplay").innerText={en:"EN","zh-TW":"繁","zh-CN":"简"}[e],myName=generateRandomName(),document.getElementById("myName").innerText=myName}function toggleLanguage(){updateLanguage("en"===currentLang?"zh-TW":"zh-TW"===currentLang?"zh-CN":"en")}function t(e,t={}){let n=translations[currentLang][e]||e;for(const e in t)n=n.replace(`{${e}}`,t[e]);return n}function generateRandomName(){let e,t;return"zh-TW"===currentLang?(e=adjectives_zh,t=animals_zh):"zh-CN"===currentLang?(e=adjectives_cn,t=animals_cn):(e=adjectives_en,t=animals_en),e[Math.floor(Math.random()*e.length)]+" "+t[Math.floor(Math.random()*t.length)]}let myName=generateRandomName();function generateSixDigitId(){let e="";const t="012356789";for(let n=0;n<6;n++)e+=t.charAt(Math.floor(9*Math.random()));return e}const mySixDigitId=generateSixDigitId(),peerId=`AIRCAT-${mySixDigitId}`;document.getElementById("myName").innerText=myName,document.getElementById("myIdDisplay").innerText=mySixDigitId,document.getElementById("bigIdDisplay").innerText=mySixDigitId,updateLanguage(currentLang),new QRCode(document.getElementById("qrcode"),{text:peerId,width:160,height:160,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.M});let peers={},currentTargetId=null,selectedPeerIds=new Set,isMultiSelectMode=!1,html5QrCode=null,connectionTimeout=null;const SIGNALING_SERVER_URL="wss://ws.aircat.cc";let customWs=null,currentCustomGroup=null,reconnectDelay=3e3;const transferLog=[];function escapeHtml(e){if(!e)return"";const t=document.createElement("div");return t.textContent=String(e),t.innerHTML}function editMyName(){const e=prompt(t("edit_name_prompt"),myName);e&&e.trim()&&e!==myName&&(myName=e.trim().slice(0,20),document.getElementById("myName").innerText=myName,Object.values(peers).forEach((e=>{e.conn&&e.conn.open&&e.conn.send({type:"handshake",name:myName})})),showToast(t("toast_renamed")))}function playNotificationSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.type="sine",t.frequency.setValueAtTime(880,e.currentTime),n.gain.setValueAtTime(.1,e.currentTime),n.gain.exponentialRampToValueAtTime(.001,e.currentTime+.1),t.start(e.currentTime),t.stop(e.currentTime+.1)}catch(e){}}function addLog(e,n,o,a,s,r){const c=(new Date).toLocaleTimeString("en"===currentLang?"en-US":"zh-TW",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});transferLog.push({time:c,direction:e,type:n,name:o,size:a,peerName:s,content:r});const i=document.getElementById("logContent");1===transferLog.length&&(i.innerHTML="");const l="sent"===e,d="text"===n?"fa-comment":"fa-file-arrow-up",m=l?"text-blue-600":"text-green-600",u=l?"bg-blue-50 border-blue-200":"bg-green-50 border-green-200",g=l?t("log_sent")+` ${escapeHtml(s)}`:t("log_recv")+` ${escapeHtml(s)}`;let p="";"text"===n?p=`<div class="text-xs text-gray-600 mt-2 bg-white p-2 rounded border border-gray-200 line-clamp-2">${escapeHtml(r)}</div>`:"file"===n&&(p=`<div class="text-xs text-gray-500 mt-1">${escapeHtml(a)}</div>`);const f=`\n    <div class="flex items-start p-3 rounded-xl border shadow-sm ${u} animate-fade-in-up">\n        <div class="${m} mt-1 mr-3"><i class="fa-solid ${d} text-lg"></i></div>\n        <div class="flex-1 min-w-0">\n            <div class="flex justify-between items-baseline mb-1">\n                <span class="text-xs font-black text-gray-700">${g}</span>\n                <span class="text-[10px] text-gray-400 font-mono">${c}</span>\n            </div>\n            <div class="font-bold text-sm truncate" title="${escapeHtml(o)}">${escapeHtml(o)}</div>\n            ${p}\n        </div>\n    </div>`;i.insertAdjacentHTML("afterbegin",f)}function promptForManualGroup(){const e=prompt(t("manual_group_prompt"),currentCustomGroup||"");null!==e&&e!==currentCustomGroup&&(currentCustomGroup=e,customWs&&customWs.readyState===WebSocket.OPEN?customWs.close():initWebSocketSignaling())}const peer=new Peer(peerId,{debug:1,config:{iceServers:[{urls:"stun:stun.qq.com:3478"},{urls:"stun:stun.miwifi.com:3478"},{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.stunprotocol.org:3478"}]}});function initWebSocketSignaling(){const e=document.getElementById("discoText"),n=document.getElementById("discoStatus");try{customWs=new WebSocket(SIGNALING_SERVER_URL),customWs.onopen=()=>{reconnectDelay=3e3,console.log("Connected to Custom Signaling Server!"),n.classList.add("active"),n.classList.remove("searching"),e.innerText=currentCustomGroup?t("server_joined")+escapeHtml(currentCustomGroup):t("server_ready"),customWs.send(JSON.stringify({type:"join",peerId:peerId,customRoomKey:currentCustomGroup}))},customWs.onmessage=e=>{try{const t=JSON.parse(e.data);"peers-found"===t.type?t.peers.forEach((e=>{connectToPeer(e)})):"peer-joined"===t.type&&connectToPeer(t.peerId)}catch(e){console.error("WS parse error:",e)}},customWs.onclose=()=>{n.classList.remove("active"),n.classList.add("searching"),e.innerText=t("server_disconnected",{seconds:Math.round(reconnectDelay/1e3)}),setTimeout((()=>{reconnectDelay=Math.min(2*reconnectDelay,6e4),initWebSocketSignaling()}),reconnectDelay)},customWs.onerror=e=>{customWs.close()}}catch(e){console.error("Failed to setup WebSocket:",e)}}function connectToPeer(e=null){let n=e||document.getElementById("targetPeerId").value.trim();if(!n)return showToast(t("toast_enter_id"));if(n.startsWith("AIRCAT-")||(n="AIRCAT-"+n),n===peerId)return;if(peers[n])return;showToast(t("toast_connecting"));const o=peer.connect(n,{reliable:!0});connectionTimeout&&clearTimeout(connectionTimeout),connectionTimeout=setTimeout((()=>{o.open||(showToast(t("toast_no_response"),!0),o.close())}),1e4),o.on("open",(()=>{clearTimeout(connectionTimeout),setupConnection(o),closePairingModal(),showToast(t("toast_connecting"))})),o.on("error",(n=>{clearTimeout(connectionTimeout),e||showToast(t("toast_conn_error"),!0)}))}function setupConnection(e){peers[e.peer]||(peers[e.peer]={conn:e,name:t("server_connecting"),lastSeen:Date.now()},renderPeer(e.peer,t("server_connecting")),e.on("data",(t=>{handleData(t,e.peer)})),e.on("close",(()=>{removePeer(e.peer),showToast(t("toast_device_disconnected"))})),e.on("error",(t=>{removePeer(e.peer)})),setTimeout((()=>{e.open&&e.send({type:"handshake",name:myName})}),500))}function handleData(e,n){if("handshake"===e.type){if(peers[n]){const o=peers[n].name===t("server_connecting");if(peers[n].name=e.name,renderPeer(n,e.name),document.getElementById("instruction").style.display="none",o){showToast(t("toast_connected")+e.name);const o=n.replace("AIRCAT-","");try{const t=JSON.parse(localStorage.getItem("aircat_history")||"[]").filter((e=>e.id!==o));t.unshift({id:o,name:e.name,lastSeen:Date.now()}),localStorage.setItem("aircat_history",JSON.stringify(t.slice(0,10)))}catch(e){}}else showToast(t("toast_device_renamed")+e.name)}}else"text"===e.type?(playNotificationSound(),addLog("received","text",t("text_msg"),"",peers[n]?.name||"未知",e.content),showReceiveModal("text",e)):"file-meta"===e.type&&(playNotificationSound(),addLog("received","file",e.fileName,e.fileSize,peers[n]?.name||"未知",""),showReceiveModal("file",e))}peer.on("open",(e=>{document.getElementById("statusIndicator").className="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e]",showToast(t("toast_online")),initWebSocketSignaling(),setInterval((()=>{peer.disconnected&&peer.reconnect()}),5e3)})),peer.on("error",(e=>{console.error(e),"unavailable"===e.type?showToast(t("toast_id_conflict")):"peer-unavailable"===e.type||showToast(t("toast_conn_error")+e.type,!0),document.getElementById("statusIndicator").className="w-2 h-2 rounded-full bg-red-500"})),peer.on("connection",(e=>{e.on("open",(()=>setupConnection(e)))}));const dragOverlay=document.getElementById("dragOverlay");let dragCounter=0;function renderPeer(e,t){let n=document.getElementById(`peer-${e}`);if(n)return void(n.querySelector("span").innerText=escapeHtml(t));const o=document.getElementById("peers-container");n=document.createElement("div"),n.id=`peer-${e}`,n.className="device-float flex flex-col items-center cursor-pointer transition transform hover:scale-105 active:scale-95 group tap-highlight-transparent",n.onclick=()=>openActionMenu(e,t);const a=["fa-mobile-screen","fa-laptop","fa-desktop","fa-tablet-screen-button"],s=a[Math.floor(Math.random()*a.length)],r=selectedPeerIds.has(e),c=r?"ring-4 ring-offset-2 ring-blue-500":"",i=r?'<div class="absolute top-0 right-0 bg-blue-500 text-white rounded-bl-xl px-2 py-1"><i class="fa-solid fa-check text-xs"></i></div>':"";n.innerHTML=`\n        <div class="w-20 h-20 md:w-24 md:h-24 bg-white hover:bg-black group-hover:text-white rounded-2xl flex items-center justify-center mb-3 border-4 border-black relative transition-all shadow-hard ${c}">\n            <i class="fa-solid ${s} text-3xl md:text-4xl text-black group-hover:text-white transition-colors"></i>\n            <div class="absolute -top-3 -right-3 w-6 h-6 bg-green-400 rounded-full border-2 border-black flex items-center justify-center shadow-sm">\n                    <div class="w-2 h-2 bg-white rounded-full animate-pulse"></div>\n            </div>\n            ${i}\n        </div>\n        <span class="font-bold text-black bg-white px-2 py-1 border-2 border-black rounded shadow-hard-sm text-sm max-w-[120px] truncate" title="${escapeHtml(t)}">${escapeHtml(t)}</span>\n    `,o.appendChild(n),document.getElementById("instruction").style.display="none"}function removePeer(e){if(peers[e]){delete peers[e];const t=document.getElementById(`peer-${e}`);t&&t.remove(),0===Object.keys(peers).length&&(document.getElementById("instruction").style.display="block")}}function openActionMenu(e,t){if(isMultiSelectMode)return void togglePeerSelection(e);selectedPeerIds.clear(),selectedPeerIds.add(e),updateSelectionUI(),currentTargetId=e;const n=peers[e]?peers[e].name:t;document.getElementById("targetName").innerText=escapeHtml(n),showModal("actionModal")}function togglePeerSelection(e){selectedPeerIds.has(e)?selectedPeerIds.delete(e):selectedPeerIds.add(e),updateSelectionUI()}function updateSelectionUI(){Object.keys(peers).forEach((e=>{renderPeer(e,peers[e].name)}));const e=document.getElementById("multiActionBtn");selectedPeerIds.size>0?(e.classList.remove("hidden"),e.querySelector("span").innerText=`${t("btn_group_send")} (${selectedPeerIds.size})`):e.classList.add("hidden")}function triggerMultiAction(){if(0===selectedPeerIds.size)return;const e=Array.from(selectedPeerIds).map((e=>peers[e]?.name)).join(", ");document.getElementById("targetName").innerText=e.length>20?e.slice(0,20)+"...":e,showModal("actionModal")}function toggleMultiSelectMode(){isMultiSelectMode=!isMultiSelectMode;const e=document.getElementById("toggleMultiBtn");isMultiSelectMode?(e.classList.add("bg-black","text-white"),e.classList.remove("bg-white","text-black"),showToast(t("toast_multi_mode_on"))):(e.classList.remove("bg-black","text-white"),e.classList.add("bg-white","text-black"),selectedPeerIds.clear(),updateSelectionUI(),showToast(t("toast_multi_mode_off")))}function triggerFileSelect(){document.getElementById("fileInput").click(),closeModal("actionModal")}function handleFileSelect(e){const t=Array.from(e.files);t.length&&(handleFiles(t),e.value="")}function handleFiles(e){const n=[];let o=0;const a=e.length;function s(){o++,o===a&&n.length>0&&showToast(t("toast_sent")+n.join(", "))}e.forEach((e=>function(e){if(e.size>20971520){const n=(e.size/1048576).toFixed(1);if(!confirm(t("file_size_warning",{fileName:e.name,size:n})))return void s()}const o=new FileReader;o.onload=function(t){const o={type:"file-meta",id:peerId,sender:myName,fileName:e.name,fileSize:(e.size/1024).toFixed(1)+" KB",fileType:e.type,content:t.target.result};(selectedPeerIds.size>0?Array.from(selectedPeerIds):[currentTargetId]).forEach((t=>{sendData(t,o),addLog("sent","file",e.name,(e.size/1024).toFixed(1)+" KB",peers[t]?.name||"未知","")})),n.push(e.name),s()},o.onerror=()=>{showToast(t("toast_read_fail")+e.name,!0),s()},o.readAsDataURL(e)}(e)))}function showInputMessage(){closeModal("actionModal"),showModal("msgModal"),setTimeout((()=>document.getElementById("msgInput").focus()),100)}function sendText(){const e=document.getElementById("msgInput").value.trim();if(!e)return;if(e.length>1e4)return showToast(t("toast_msg_too_long"),!0);const n={type:"text",id:peerId,sender:myName,content:e};(selectedPeerIds.size>0?Array.from(selectedPeerIds):[currentTargetId]).forEach((o=>{sendData(o,n),addLog("sent","text",t("text_msg"),"",peers[o]?.name||"未知",e)})),document.getElementById("msgInput").value="",closeModal("msgModal"),showToast(t("toast_msg_sent"))}function sendData(e,n){const o=peers[e];if(o)try{o.conn&&o.conn.open?o.conn.send(n):showToast(t("toast_not_ready"),!0)}catch(e){console.error(e),showToast(t("toast_send_fail"),!0)}}function openPairingModal(){showModal("pairingModal"),switchTab("tab-my-code"),renderHistory()}async function closePairingModal(){try{await stopScanner()}catch(e){}closeModal("pairingModal")}function renderHistory(){try{const e=JSON.parse(localStorage.getItem("aircat_history")||"[]"),t=document.getElementById("historySection"),n=document.getElementById("historyList");if(!e.length)return void t.classList.add("hidden");t.classList.remove("hidden"),n.innerHTML=e.map((e=>`\n            <button onclick="document.getElementById('targetPeerId').value='${escapeHtml(e.id)}'; connectToPeer();"\n                class="w-full flex items-center justify-between text-left bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 hover:bg-black hover:text-white transition text-xs font-bold shadow-sm">\n                <span>${escapeHtml(e.name)} <span class="font-mono opacity-60 ml-1">#${escapeHtml(e.id)}</span></span>\n                <i class="fa-solid fa-link"></i>\n            </button>\n        `)).join("")}catch(e){}}function switchTab(e){document.getElementById("btn-tab-my").className="tab-my-code"===e?"flex-1 py-2 font-bold border-b-4 border-black":"flex-1 py-2 font-bold border-b-4 border-transparent text-gray-400",document.getElementById("btn-tab-scan").className="tab-scan"===e?"flex-1 py-2 font-bold border-b-4 border-black":"flex-1 py-2 font-bold border-b-4 border-transparent text-gray-400",document.getElementById("tab-my-code").classList.toggle("hidden","tab-my-code"!==e),document.getElementById("tab-scan").classList.toggle("hidden","tab-scan"!==e),document.getElementById("tab-scan").classList.toggle("flex","tab-scan"===e),"tab-my-code"===e&&stopScanner()}function loadHtml5QrCodeScript(){return new Promise(((e,t)=>{if(window.Html5Qrcode)return e();const n=document.createElement("script");n.src="https://unpkg.com/html5-qrcode",n.onload=e,n.onerror=t,document.head.appendChild(n)}))}function startScanner(){const e=document.getElementById("reader-container"),n=document.getElementById("startScanBtn");e.classList.remove("hidden"),n.classList.add("hidden"),n.innerText="Loading Camera...",n.classList.remove("hidden"),loadHtml5QrCodeScript().then((()=>{n.classList.add("hidden"),html5QrCode&&html5QrCode.clear(),html5QrCode=new Html5Qrcode("reader"),html5QrCode.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},onScanSuccess).catch((e=>{showToast(t("toast_camera_fail")||"Camera failed",!0),stopScanner()}))})).catch((e=>{showToast("Failed to load QR scanner library",!0),stopScanner()}))}async function stopScanner(){if(html5QrCode&&html5QrCode.isScanning)try{await html5QrCode.stop(),html5QrCode.clear()}catch(e){}document.getElementById("reader-container").classList.add("hidden"),document.getElementById("startScanBtn").classList.remove("hidden")}function onScanSuccess(e){e.startsWith("AIRCAT-")?stopScanner().then((()=>{const t=e.replace("AIRCAT-","");document.getElementById("targetPeerId").value=t,connectToPeer(e)})):showToast(t("toast_invalid_code"),!0)}function showReceiveModal(e,n){const o=String(n.sender||"Unknown").slice(0,50);if("file"===e){if(!String(n.content||"").startsWith("data:"))return void showToast(t("toast_invalid_file"),!0);n.fileName=String(n.fileName||"unnamed").replace(/[\/\\:*?"<>|]/g,"_").slice(0,255),n.fileSize=String(n.fileSize||"").slice(0,20)}"text"===e&&String(n.content||"").length>5e4&&(n.content=n.content.slice(0,5e4)+"\n\n[訊息過長，已截斷]");const a=document.getElementById("receiveModal"),s=document.getElementById("receiveContent");document.getElementById("receiveSender").innerText=t("recv_from",{name:escapeHtml(o)}),a.classList.remove("hidden");const r="item_"+Date.now()+"_"+Math.floor(1e4*Math.random());let c="";if("text"===e)c=`\n            <div class="bg-white p-3 rounded-lg border-2 border-black shadow-sm">\n                <div class="flex items-center justify-between mb-2 pb-2 border-b border-gray-100">\n                    <span class="font-bold text-xs"><i class="fa-solid fa-comment mr-1"></i> ${t("text_msg")}</span>\n                    <button id="btn_${r}" class="bg-black text-white text-[10px] px-3 py-1.5 rounded hover:bg-gray-800 transition shadow-sm font-bold"><i class="fa-solid fa-copy mr-1"></i> ${t("copy")}</button>\n                </div>\n                <div class="text-sm break-words whitespace-pre-wrap">${escapeHtml(n.content)}</div>\n            </div>\n        `;else if("file"===e){let e="";n.fileType&&n.fileType.startsWith("image/")&&(e=`<div class="mt-2 flex justify-center bg-gray-50 p-2 rounded border border-gray-100"><img src="${escapeHtml(n.content)}" class="max-h-24 object-contain rounded shadow-sm" alt="preview"></div>`),c=`\n            <div class="bg-white p-3 rounded-lg border-2 border-black shadow-sm flex flex-col">\n                <div class="flex items-center justify-between mb-1">\n                    <div class="flex items-center overflow-hidden mr-2">\n                        <i class="fa-solid fa-file-arrow-down mr-2 text-blue-600"></i>\n                        <span class="font-bold text-xs truncate" title="${escapeHtml(n.fileName)}">${escapeHtml(n.fileName)}</span>\n                    </div>\n                    <button id="btn_${r}" class="shrink-0 bg-black text-white text-[10px] px-3 py-1.5 rounded hover:bg-gray-800 transition shadow-sm font-bold"><i class="fa-solid fa-download mr-1"></i> ${t("download")}</button>\n                </div>\n                <div class="text-[10px] text-gray-500 font-bold mb-1">${escapeHtml(n.fileSize)}</div>\n                ${e}\n            </div>\n        `}s.insertAdjacentHTML("beforeend",c),setTimeout((()=>{const o=document.getElementById(`btn_${r}`);o&&("text"===e?o.onclick=()=>{navigator.clipboard.writeText(n.content).then((()=>{o.innerHTML=`<i class="fa-solid fa-check mr-1"></i> ${t("toast_copy_success")}`,o.classList.replace("bg-black","bg-green-600"),setTimeout((()=>{o.innerHTML=`<i class="fa-solid fa-copy mr-1"></i> ${t("copy")}`,o.classList.replace("bg-green-600","bg-black")}),2e3)})).catch((()=>showToast(t("toast_copy_fail"),!0)))}:"file"===e&&(o.onclick=()=>{const e=document.createElement("a");e.href=n.content,e.download=n.fileName,document.body.appendChild(e),e.click(),document.body.removeChild(e),o.innerHTML=`<i class="fa-solid fa-check mr-1"></i> ${t("toast_download_success")}`,o.classList.replace("bg-black","bg-blue-600")}))}),0),setTimeout((()=>{s.scrollTop=s.scrollHeight}),50)}function closeReceiveModal(){closeModal("receiveModal"),setTimeout((()=>{document.getElementById("receiveModal").classList.contains("hidden")&&(document.getElementById("receiveContent").innerHTML="")}),300)}function showModal(e){document.getElementById(e).classList.remove("hidden")}function closeModal(e){document.getElementById(e).classList.add("hidden")}function showToast(e,t=!1){const n=document.createElement("div"),o=t?"bg-orange-100 text-orange-700 border-orange-500":"bg-black text-white border-black";n.className=`fixed top-20 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg border-2 shadow-hard font-bold z-[99999] transition-all duration-300 translate-y-[-20px] opacity-0 text-center w-max max-w-[90vw] ${o}`,n.innerHTML=`${t?'<i class="fa-solid fa-triangle-exclamation mr-2"></i>':'<i class="fa-solid fa-check-circle mr-2 text-green-400"></i>'} ${escapeHtml(e)}`,document.body.appendChild(n),requestAnimationFrame((()=>n.classList.remove("translate-y-[-20px]","opacity-0"))),setTimeout((()=>{n.classList.add("translate-y-[-20px]","opacity-0"),setTimeout((()=>n.remove()),300)}),3500)}window.addEventListener("dragenter",(e=>{e.preventDefault(),dragCounter++;Object.keys(peers).filter((e=>peers[e].conn&&peers[e].conn.open)).length>0&&(dragOverlay.classList.remove("hidden"),dragOverlay.classList.add("opacity-100"))})),window.addEventListener("dragleave",(e=>{e.preventDefault(),dragCounter--,0===dragCounter&&dragOverlay.classList.add("hidden")})),window.addEventListener("dragover",(e=>e.preventDefault())),window.addEventListener("drop",(e=>{e.preventDefault(),dragCounter=0,dragOverlay.classList.add("hidden");const n=Array.from(e.dataTransfer.files);if(0===n.length)return;const o=Object.keys(peers).filter((e=>peers[e].conn&&peers[e].conn.open));0!==o.length?selectedPeerIds.size>0?handleFiles(n):1===o.length?(selectedPeerIds.add(o[0]),handleFiles(n),selectedPeerIds.clear()):showToast(t("toast_multi_device"),!0):showToast(t("toast_no_receiver"),!0)})),document.addEventListener("keydown",(e=>{if("Escape"===e.key)return void["pairingModal","actionModal","msgModal","receiveModal","aboutModal","logModal"].forEach((e=>{const t=document.getElementById(e);t&&!t.classList.contains("hidden")&&("pairingModal"===e?closePairingModal():"receiveModal"===e?closeReceiveModal():closeModal(e))}));const t=e.metaKey||e.ctrlKey;if(t&&"Enter"===e.key&&!document.getElementById("msgModal").classList.contains("hidden"))return e.preventDefault(),void sendText();t&&"k"===e.key.toLowerCase()&&(e.preventDefault(),openPairingModal()),t&&"l"===e.key.toLowerCase()&&(e.preventDefault(),showModal("logModal"))}));const setAppHeight=()=>document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`);window.addEventListener("resize",setAppHeight),setAppHeight();